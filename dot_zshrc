if [ "$(uname -s)" = "Linux" ]; then
  export LINUX=true
else
  export OSX=true
fi

# Aliases
if [ "$OSX" = "true" ]; then
  alias code="/Applications/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code"
fi
alias cz="chezmoi"
if hash hub 2> /dev/null; then
  alias git="hub"
fi
alias killforeman='ps aux | grep foreman | sed -E "s/ +/ /g" | cut -d " " -f 2 | xargs kill -9'
alias loopnzb="while (True) { sleep 5; movenzb; }"
if hash lsd 2> /dev/null; then
  alias ls="lsd"
fi
alias la="ls -al"
alias ll="ls -l"
alias reload="source ~/.zshrc"

movenzb() {
  files=$(ls $HOME/Desktop/*.nzb | wc -l | tr -d " ")
  if [ $files = "0" ]; then
    echo "Found 0 nzbs"
  else
    echo "Moving $files nzbs"
    $(mv $HOME/Desktop/*.nzb $HOME/Dropbox/Usenet)
  fi
}

# Exports
if type nvim &>/dev/null; then
  export EDITOR=nvim
else
  export EDITOR=vim
fi
export HISTFILE=~/.zshistory
export HISTSIZE=1000000
export SAVEHIST=1000000

# Options
setopt share_history

# Load programs
if hash starship 2> /dev/null; then
  eval "$(starship init zsh)"
fi

# https://docs.brew.sh/Shell-Completion
if type brew &>/dev/null
then
  FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"

  autoload -Uz compinit
  compinit
fi

if hash asdf 2> /dev/null; then
  if [ "$OSX" = "true" ]; then
    . /opt/homebrew/opt/asdf/libexec/asdf.sh
  else
    . $(brew --prefix asdf)/asdf.sh 
  fi
fi

if type zoxide &>/dev/null; then
  eval "$(zoxide init zsh)"
fi

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

if [ "$LINUX" = "true" ]; then
  source ~/.linux-path
else
  source ~/.osx-path
fi

# Anything local that shouldn't be in git
[ -f ~/.local-machine ] && source ~/.local-machine

# Enable Ctrl-x-e to edit command line
autoload -U edit-command-line
# Emacs style
zle -N edit-command-line
bindkey '^xe' edit-command-line
bindkey '^x^e' edit-command-line

return 0
